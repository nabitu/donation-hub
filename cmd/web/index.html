<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DonationHub</title>
    <!-- Bootstrap CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* Custom CSS styles can be added here */
        .project-card {
            margin-bottom: 20px;
        }

        .project-description {
            margin-top: 20px;
        }
    </style>
</head>

<body x-data="app()">
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="#">DonationHub</a>
            <div x-show="admin">
                <a class="btn btn-outline-light ml-auto" href="users.html">Registered User</a>
            </div>
            <div x-show="isAuthenticated">
                <button class="btn btn-outline-light ml-auto" @click.prevent="logout">Log Out</button>
            </div>
            <div x-show="!isAuthenticated">
                <a class="btn btn-outline-light ml-auto" href="login.html">Log In</a>
            </div>
        </div>
    </nav>

    <!-- Content -->
    <div class="container mt-4">
        <!-- Home Page -->
        <div id="home-page">
            <h1>Welcome to DonationHub</h1>
            <p>
                DonationHub is a platform connecting donors with those in need. Explore our projects and make a
                difference today.
            </p>
            <!-- Project Cards -->
            <div id="project-cards" class="row">
                <!-- Dummy projects (6 per page) -->
                <!-- Loop through projects -->
                <template x-for="project in projects" :key="project.id">
                    <div class="col-md-4">
                        <div class="card project-card">
                            <div class="card-body">
                                <h5 class="card-title" x-text="project.title"></h5>
                                <p class="card-text" x-text="project.description"></p>
                                <!-- Image slideshow -->
                                <img :src="project.image_urls[0]" class="d-block w-100 mb-3" alt="Project Image">
                                <!-- Donation details -->
                                <p>
                                    <strong>Amount Needed:</strong>
                                    <span x-text="formatNumber(project.target_amount)"></span>
                                    <span x-text="project.currency"></span>
                                </p>
                                <!-- <p><strong>Collected:</strong> {{ project.collected }} ({{ project.percentCollected }}%)</p> -->
                                <!-- View Details button -->
                                <a href="#detail-page" class="btn btn-primary" @click="showDetailPage(project)">View Details</a>
                            </div>
                        </div>
                    </div>
                </template>
                <!-- Add more project cards here -->
            </div>
            <!-- Load More button -->
            <div class="text-center mt-4" x-show="lastKey">
                <button id="load-more-btn" class="btn btn-secondary" @click.prevent="loadmore">Load More</button>
            </div>
        </div>

        <!-- Detail Page -->
        <div id="detail-page" style="display: none;">
            <div class="row">
                <!-- Image slideshow -->
                <div class="col-md-6">
                    <div id="image-slider" class="carousel slide" data-ride="carousel">
                        <div class="carousel-inner">
                            <div class="carousel-item active">
                                <img src="https://via.placeholder.com/600x400" class="d-block w-100" alt="Slide 1">
                            </div>
                            <div class="carousel-item">
                                <img src="https://via.placeholder.com/600x400" class="d-block w-100" alt="Slide 2">
                            </div>
                            <div class="carousel-item">
                                <img src="https://via.placeholder.com/600x400" class="d-block w-100" alt="Slide 3">
                            </div>
                            <!-- Add more images here -->
                        </div>
                        <a class="carousel-control-prev" href="#image-slider" role="button" data-slide="prev">
                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                            <span class="sr-only">Previous</span>
                        </a>
                        <a class="carousel-control-next" href="#image-slider" role="button" data-slide="next">
                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                            <span class="sr-only">Next</span>
                        </a>
                    </div>
                </div>
                <!-- Project description -->
                <div class="col-md-6">
                    <div class="project-description">
                        <h1>Project Title 1</h1>
                        <p>
                            Project description: Lorem ipsum dolor sit amet, consectetur adipiscing elit. Ut eget ligula
                            auctor, rhoncus magna et, ullamcorper velit. Duis faucibus posuere nulla, vel mollis libero
                            ultrices non. Curabitur ultricies justo id pulvinar consequat. Vivamus nec ultricies velit.
                            Nullam eu elit leo. Phasellus feugiat odio in ipsum sollicitudin, sit amet tincidunt odio
                            tempor. Fusce lobortis id odio non eleifend. Integer eleifend tortor vitae nisl tincidunt,
                            eu hendrerit urna pulvinar.
                        </p>
                    </div>
                </div>
            </div>
            <!-- Donation details -->
            <p><strong>Amount Needed:</strong> $5000</p>
            <p><strong>Collected:</strong> $2500 (50%)</p>
            <!-- Donations and their messages -->
            <h2>Donations</h2>
            <ul>
                <li>$50 - "Wish you all the best!" by @johndoe</li>
                <li>$100 - "Great project!" by @alfonso</li>
            </ul>
            <button class="btn btn-success">Donate Now</button>
        </div>

        <!-- Admin Page -->
        <div id="admin-page" style="display: none;">
            <h1>Admin Dashboard</h1>
            <h2>Donation Projects</h2>
            <ul>
                <li>Project Title 1 - Total Donations: $2500 (50%)</li>
                <li>Project Title 2 - Total Donations: $0 (0%)</li>
            </ul>
            <h2>Donors</h2>
            <ul>
                <li>Donor 1</li>
                <li>Donor 2</li>
            </ul>
            <h2>Recipients</h2>
            <ul>
                <li>Recipient 1</li>
                <li>Recipient 2</li>
            </ul>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-white mt-5">
        <div class="container py-4">
            <div class="row">
                <div class="col-md-6">
                    <h5>DonationHub</h5>
                    <p>A platform connecting donors with those in need.</p>
                </div>
                <div class="col-md-6">
                    <h5>Contact Us</h5>
                    <ul>
                        <li>Email: info@donationhub.com</li>
                        <li>Phone: +1 123-456-7890</li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="text-center py-2" style="background-color: #343a40;">
            &copy; 2024 DonationHub. All rights reserved.
        </div>
    </footer>

    <!-- Bootstrap JS and dependencies -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script defer>
        function app() {
            return {
                async init() {
                    console.log('Initializing app')
                    await this.checkForToken()
                    await this.getProjects()
                    await this.getMe()
                },
                formatNumber(number) {
                    return new Intl.NumberFormat().format(number)
                },
                async getProjects() {
                    console.log('Getting projects')
                    try {
                        const token = localStorage.getItem('token');
                        const headers = {};
                        if (token) {
                            headers['Authorization'] = `Bearer ${token}`;
                        }

                        const response = await axios.get(`${this.baseUrl}/projects?last_key=${this.lastKey}&limit=9`, {headers});
                        this.lastKey = response.data.data.last_key;
                        this.projects = [...this.projects, ...response.data.data.projects];
                    } catch (error) {
                        console.log('Error getting projects')
                        console.error(error);
                    }
                },
                async logout() {
                    console.log('Logging out')
                    localStorage.removeItem('token')
                    this.isAuthenticated = false
                    this.admin = false
                },
                async checkForToken() {
                    console.log('Checking for token')
                    token = localStorage.getItem('token')
                    if (token) {
                        console.log('Token found')
                        this.isAuthenticated = true
                        return true
                    }
                    return false;
                },
                async loadmore() {
                    this.getProjects()
                },
                async getMe() {
                    if (!localStorage.getItem('token')) {
                        console.log('Not logged in, skipping getMe')
                        return;
                    }
                    try {

                        console.log('Getting user')
                        if (!localStorage.getItem('token')) {
                            console.log('No token found, skipping user check')
                        }

                        const response = await axios.get(`${this.baseUrl}/me`, {
                            headers: {
                                Authorization: `Bearer ${localStorage.getItem('token')}`
                            }
                        });
                        console.log('User is authenticated', response.data.data.roles)
                        localStorage.setItem('role', response.data.data.roles);
                        await this.isAdmin()
                    } catch (error) {
                        console.error('Error getting user')
                        console.error(error)
                    }

                },
                async isAdmin() {
                    console.log('Checking if user is admin')
                    const role = localStorage.getItem('role');
                    if (role === 'admin') {
                        console.log('User is admin')
                        this.admin = true
                        return true
                    }
                },
                admin: false,
                lastKey: null,
                baseUrl: 'http://localhost:8180',
                isLoading: false,
                isAuthenticated: false,
                projects: [],
            }
        }
    </script>
</body>

</html>